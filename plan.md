# Flutter + Shadcn å°è¯´é˜…è¯»å™¨é‡æ„è®¡åˆ’ï¼ˆå‚è€ƒ legadoï¼‰

## 1. é¡¹ç›®ç›®æ ‡

- åœ¨å½“å‰ç›®å½•ä»é›¶é‡å»ºä¸€å¥— **Flutter æ¶æ„** çš„å°è¯´é˜…è¯»å™¨ã€‚
- ä»¥åŒçº§é¡¹ç›® `../legado` çš„èƒ½åŠ›ä¸ºåŠŸèƒ½åŸºçº¿ï¼Œåˆ†é˜¶æ®µå®ç°ã€‚
- UI ä½“ç³»ç»Ÿä¸€é‡‡ç”¨ `shadcn_ui`ï¼Œå®¿ä¸»ä»…ä½¿ç”¨ `CupertinoApp`ï¼ˆä¸ä½¿ç”¨ Materialï¼‰ã€‚
- å…ˆå®ç° MVPï¼ˆå¯ç”¨é˜…è¯»é“¾è·¯ï¼‰ï¼Œå†è¡¥é½é«˜çº§èƒ½åŠ›ï¼ˆè§„åˆ™å¼•æ“ã€è®¢é˜…ã€Web APIã€åŒæ­¥ç­‰ï¼‰ã€‚
- å½“å‰é˜¶æ®µèŒƒå›´è£å‰ªï¼š**ä»…åšæ–‡æœ¬å°è¯´é˜…è¯»èƒ½åŠ›**ï¼›æ¼«ç”»ã€å›¾ç‰‡ç« èŠ‚ç­‰èƒ½åŠ›æš‚ä¸çº³å…¥å®ç°èŒƒå›´ã€‚

### 1.1 å½“å‰è¿›åº¦ï¼ˆæˆªè‡³ 2026-02-11ï¼‰

- âœ… å·²å®Œæˆï¼šFlutter å·¥ç¨‹åˆå§‹åŒ–ã€`Shadcn + Cupertino` å®¿ä¸»ã€`go_router` å›› tab å£³å±‚ã€‚
- âœ… å·²å®Œæˆï¼š`Dio` ç½‘ç»œåŸºç¡€å±‚ã€`Drift` æ•°æ®å±‚ï¼ˆ`Book`/`BookSource`/`BookChapter`ï¼‰ä¸è¿ç§»åˆ° `schemaVersion=3`ã€‚
- âœ… å·²å®Œæˆï¼šlegado å…¼å®¹ä¹¦æº JSON å¯¼å…¥å™¨ï¼ˆå«æ‰¹é‡å¯¼å…¥å’Œå­—æ®µå®¹é”™ï¼‰ã€‚
- âœ… å·²å®Œæˆï¼šæœç´¢è§„åˆ™åŸºç¡€è§£æï¼ˆJSON + HTML/CSS å­é›†ï¼‰ä¸æœç´¢èšåˆæœåŠ¡ã€‚
- âœ… å·²å®Œæˆï¼šå‘ç°é¡µâ€œæœç´¢ -> åŠ å…¥ä¹¦æ¶å¹¶é˜…è¯»â€é“¾è·¯ã€‚
- âœ… å·²å®Œæˆï¼šé˜…è¯»é¡µç›®å½•/æ­£æ–‡åŠ è½½é—­ç¯ï¼ˆ`ruleToc` / `ruleContent` åŸºç¡€è·¯å¾„è§£æï¼‰ã€‚
- âœ… å·²å®Œæˆï¼šiOS GitHub Action æ‰“åŒ…æµç¨‹ï¼ˆå‚è€ƒ `soupreader`ï¼‰ã€‚
- ğŸ”„ è¿›è¡Œä¸­ï¼šå‘ legado å®Œæ•´è§„åˆ™èƒ½åŠ›å¯¹é½ï¼ˆXPath/JsonPath å…¨é‡ã€JS æ‰§è¡Œã€å¤æ‚è§„åˆ™è¯­æ³•ï¼‰ã€‚

---

## 2. å‚è€ƒè¾“å…¥

### 2.1 Legado åŠŸèƒ½æ¸…å•ï¼ˆæŒ‰æ¨¡å—æ¢³ç†ï¼‰

> ç›®æ ‡ï¼šæŠŠ Legado ä½œä¸ºâ€œåŠŸèƒ½åŸºçº¿â€ï¼Œå°½é‡ç”¨æ¨¡å—åŒ–æ¸…å•æŠŠèƒ½åŠ›ä¸€æ¬¡æ€§æ¢³ç†æ¸…æ¥šï¼Œæ–¹ä¾¿å¯¹ç…§å®ç°ä¸æ‹† TODOã€‚
>
> è¯´æ˜ï¼šä»¥ä¸‹æ¸…å•åŸºäºæœ¬åœ° `../legado` ä»“åº“çš„ READMEã€å¸®åŠ©æ–‡æ¡£ï¼ˆ`app/src/main/assets/web/help/md/*`ï¼‰ä¸ç›®å½•ç»“æ„æ•´ç†ï¼Œè¦†ç›–äº§å“ä¸»è¦èƒ½åŠ›ä¸å¯¹å¤–æ¥å£ï¼›ç»†ç¢çš„ UI å¼€å…³ä¸é€æ¡æšä¸¾ï¼Œä»¥å…å™ªéŸ³è¿‡å¤§ã€‚

#### A. å†…å®¹è·å–ä¸è§„åˆ™å¼•æ“ï¼ˆä¹¦æºæ ¸å¿ƒï¼‰

- è‡ªå®šä¹‰ä¹¦æºï¼ˆ`BookSource`ï¼‰ï¼šæœç´¢ã€å‘ç°ã€ä¹¦ç±è¯¦æƒ…ã€ç›®å½•ã€æ­£æ–‡ã€è¯„è®º/ä¹¦è¯„ç­‰è§„åˆ™å­—æ®µã€‚
- è§„åˆ™è¯­æ³•ï¼ˆå¸®åŠ©é¡µ `ruleHelp.md`ï¼‰ï¼š
  - è§„åˆ™æ ‡å¿—ï¼š`@@`ï¼ˆé»˜è®¤è§„åˆ™ï¼‰ã€`@XPath` / `@Json`ã€æ­£åˆ™ï¼ˆä»…é™ä¹¦ç±/ç›®å½•åˆ—è¡¨ç­‰ç‰¹å®šåœºæ™¯ï¼‰ã€`{{...}}` è§„åˆ™å—ç­‰ã€‚
  - URL è§„åˆ™æ”¯æŒæºå¸¦ JS å‚æ•°ï¼ˆè§£æ URL æ—¶æ‰§è¡Œï¼‰ç”¨äºåŠ¨æ€æ”¹å†™ url/headers/bodyã€‚
- JS æ‰§è¡Œï¼ˆå¸®åŠ©é¡µ `jsHelp.md`ï¼‰ï¼šRhino å¼•æ“ + `jsLib` æ³¨å…¥ï¼ˆæ”¯æŒå‡½æ•°å¤ç”¨ã€ç¼“å­˜è„šæœ¬ã€éƒ¨åˆ† Java API æš´éœ²ä¸å®‰å…¨é™åˆ¶ï¼‰ã€‚
- ç½‘ç»œä¸åçˆ¬èƒ½åŠ›ï¼š
  - è¯·æ±‚å¤´é…ç½®ã€ä»£ç†ï¼ˆHTTP / Socks4 / Socks5ï¼‰ã€CookieJarï¼ˆè‡ªåŠ¨ä¿å­˜ `Set-Cookie`ï¼‰ã€‚
  - å¹¶å‘ç‡é™åˆ¶ï¼ˆå›ºå®šé—´éš” / é¢‘æ¬¡é™åˆ¶ `20/60000`ï¼‰ã€‚
  - ç™»å½•ä½“ç³»ï¼šç™»å½• UIã€ç™»å½• URLï¼ˆå¯ JS å®ç°ï¼‰ã€ç™»å½•æ£€æŸ¥ JSï¼›å¯å€ŸåŠ© WebView å®ŒæˆéªŒè¯ç /è·³è½¬æ‹¦æˆªç­‰ã€‚
- ç‰¹æ®Šèƒ½åŠ›ï¼ˆè§„åˆ™æ‰©å±•ï¼‰ï¼š
  - å›¾ç‰‡/å°é¢è§£å¯†ï¼ˆJS è¿”å› `ByteArray`ï¼‰ã€å›¾ç‰‡è¯·æ±‚å¯è‡ªå®šä¹‰ headersã€‚
  - å­—ä½“åæ··æ·†ï¼ˆTTF å­—å½¢æ˜ å°„æ›¿æ¢ï¼‰ã€‚
  - æ–‡ä»¶å‹ä¹¦æºï¼šä¸‹è½½/è§£å‹/ç¼“å­˜ï¼Œé€‚é…â€œæ•´åŒ…ä¸‹è½½â€çš„ç«™ç‚¹ã€‚

#### B. ä¹¦æºç®¡ç†ä¸è°ƒè¯•

- ç®¡ç†ï¼šæ–°å»º/ç¼–è¾‘ã€åˆ†ç»„ç­›é€‰ã€å¯ç”¨/ç¦ç”¨ã€å¯ç”¨/ç¦ç”¨å‘ç°ã€ç½®é¡¶/ç½®åº•ã€å¯¼å…¥/å¯¼å‡º/åˆ†äº«ã€‚
- å¯¼å…¥ï¼šæœ¬åœ°å¯¼å…¥ã€ç½‘ç»œå¯¼å…¥ã€äºŒç»´ç å¯¼å…¥ï¼ˆå¸®åŠ©é¡µ `SourceMBookHelp.md`ï¼‰ã€‚
- æ ¡éªŒï¼šæ‰¹é‡æ ¡éªŒæœç´¢/å‘ç°/ç›®å½•/æ­£æ–‡ï¼Œè‡ªåŠ¨ç­›é€‰å¤±æ•ˆæºï¼ˆç»“æœå—ç½‘ç»œç­‰å› ç´ å½±å“ï¼‰ã€‚
- è°ƒè¯•ï¼šè°ƒè¯•æœç´¢/å‘ç°/è¯¦æƒ…/ç›®å½•/æ­£æ–‡ï¼ˆå¸®åŠ©é¡µ `debugHelp.md`ï¼Œå« `++/--` ç­‰å‰ç¼€çº¦å®šï¼‰ã€‚

#### C. æ‰¾ä¹¦é“¾è·¯ï¼ˆå‘ç° / æœç´¢ / è¯¦æƒ… / æ¢æºï¼‰

- æœç´¢ï¼šå¤šä¹¦æºèšåˆæœç´¢ã€åˆ†é¡µã€æ¥æºç­›é€‰ï¼ˆèƒ½åŠ›å–å†³äºä¹¦æºè§„åˆ™ä¸å¹¶å‘ç­–ç•¥ï¼‰ã€‚
- å‘ç°ï¼šåŸºäºâ€œå‘ç°è§„åˆ™â€çš„æ¦œå•/åˆ†ç±»å…¥å£ï¼ˆå¹¶éæ‰€æœ‰ä¹¦æºéƒ½æœ‰å‘ç°ï¼‰ã€‚
- è¯¦æƒ…ï¼šä¹¦ç±ç®€ä»‹ã€ç›®å½•é¢„è§ˆã€åŠ å…¥ä¹¦æ¶ï¼›æ”¯æŒæ¢æºã€ç¼–è¾‘ä¹¦ç±å…ƒä¿¡æ¯ç­‰ã€‚

#### D. ä¹¦æ¶ä¸ä¹¦ç±ç®¡ç†

- ä¹¦æ¶ï¼šåˆ—è¡¨/ç½‘æ ¼åˆ‡æ¢ï¼›ä¸‹æ‹‰åˆ·æ–°ï¼›æ›´æ–°æç¤º/æœªè¯»ç« èŠ‚æ•°ï¼›åˆ†ç»„/æ’åºã€‚
- ä¹¦ç±è¯¦æƒ…ï¼šåˆ é™¤ã€æ¢æºã€å…è®¸/ç¦æ­¢æ›´æ–°ã€ç¼–è¾‘ä¹¦å/ä½œè€…/ç®€ä»‹ã€æ¢å°é¢ç­‰ã€‚
- ç¼“å­˜/å¯¼å‡ºï¼šç¦»çº¿ç¼“å­˜ã€ç¼“å­˜ç®¡ç†ã€å¯¼å‡º TXT/EPUBï¼ˆæ”¯æŒè‡ªå®šä¹‰å¯¼å‡ºæ–‡ä»¶åï¼‰ã€å¯¼å‡ºåˆ° WebDav ç­‰ã€‚

#### E. é˜…è¯»å™¨ï¼ˆé˜…è¯»ä½“éªŒæ ¸å¿ƒï¼‰

- æ’ç‰ˆé«˜åº¦è‡ªå®šä¹‰ï¼šå­—ä½“ã€å­—å·ã€é¢œè‰²ã€èƒŒæ™¯ã€è¡Œè·/æ®µè·ã€åŠ ç²—ã€ç®€ç¹è½¬æ¢ã€å¯¹é½ï¼ˆå«â€œæ–‡å­—åº•éƒ¨å¯¹é½â€ï¼‰ç­‰ã€‚
- å¤šç¿»é¡µæ¨¡å¼ï¼šè¦†ç›–/ä»¿çœŸ/æ»‘åŠ¨/æ»šåŠ¨ç­‰ï¼›æ”¯æŒè‡ªåŠ¨ç¿»é¡µã€‚
- ä¸»é¢˜ä¸äº®åº¦ï¼šç™½å¤©/å¤œé—´ä¸»é¢˜ã€èƒŒæ™¯ä¸å…±ç”¨å¸ƒå±€ï¼›äº®åº¦æ§ä»¶ï¼ˆå¯è·Ÿéšç³»ç»Ÿï¼‰ã€‚
- äº¤äº’ä¸å¿«æ·ï¼šç‚¹å‡»åŒºåŸŸè®¾ç½®ã€è‡ªå®šä¹‰ç¿»é¡µæŒ‰é”®ã€éŸ³é‡é”®ç¿»é¡µã€å±å¹•æ–¹å‘/è¶…æ—¶ã€éšè—çŠ¶æ€æ /å¯¼èˆªæ ç­‰ï¼ˆå¸®åŠ©é¡µ `readMenuHelp.md`ï¼‰ã€‚
- å·¥å…·èƒ½åŠ›ï¼šå…¨æ–‡æœç´¢ï¼ˆæœ¬åœ°ç¼“å­˜/æœ¬åœ°æ–‡ä»¶ï¼‰ã€ç›®å½•/ä¹¦ç­¾é¢æ¿ã€é˜…è¯»è¿›åº¦ä¿å­˜ä¸æ¢å¤ã€‚
- å›¾ç‰‡ç« èŠ‚/æ¼«ç”»ï¼šå›¾ç‰‡æ ·å¼ï¼ˆå¦‚ `full`ï¼‰ã€ç¼©æ”¾ã€æ»šåŠ¨æ¨¡å¼é€‚é…ç­‰ï¼ˆå¸®åŠ©é¡µ `appHelp.md`ï¼Œå½“å‰é˜¶æ®µä¸åšï¼‰ã€‚

#### F. æ›¿æ¢å‡€åŒ–ï¼ˆReplaceRuleï¼‰

- æ­£æ–‡æ›¿æ¢/å»å¹¿å‘Š/çº é”™ï¼šæ”¯æŒæ­£åˆ™ã€åˆ†ç»„ã€æ’åºã€å¯ç”¨/ç¦ç”¨ï¼›å¯é™å®šä½œç”¨èŒƒå›´ï¼ˆä¹¦å/æºåï¼‰ã€‚
- è§„åˆ™ç®¡ç†ï¼šå¯¼å…¥/æ–°å»º/æ’åº/é€‰æ‹©æ“ä½œï¼ˆå¸®åŠ©é¡µ `replaceRuleHelp.md`ï¼‰ã€‚

#### G. å¬ä¹¦ï¼ˆTTS / åœ¨çº¿æœ—è¯»å¼•æ“ï¼‰

- ç³»ç»Ÿ TTSï¼šåˆ‡æ¢æœ¬åœ°æœ—è¯»å¼•æ“ï¼›æ”¯æŒåå°æœ—è¯»ä¸æœ—è¯»è®¾ç½®ï¼ˆå¸®åŠ©é¡µ `readMenuHelp.md`ï¼‰ã€‚
- åœ¨çº¿æœ—è¯»ï¼ˆHttpTTSï¼‰ï¼šURL è§„åˆ™ + JS å‚æ•°ï¼ˆ`speakText`ã€`speakSpeed`ï¼‰ï¼ˆå¸®åŠ©é¡µ `httpTTSHelp.md`ï¼‰ã€‚

#### H. æœ¬åœ°ä¸è¿œç¨‹ä¹¦ç±ï¼ˆTXT / EPUB / WebDav ä¹¦ç±ï¼‰

- æœ¬åœ°ä¹¦ç±ï¼šTXT/EPUB å¯¼å…¥ï¼ˆæ‰‹åŠ¨æµè§ˆã€æ™ºèƒ½æ‰«æã€æ–‡ä»¶ç®¡ç†å™¨æ‰“å¼€ï¼‰ã€‚
- TXT ç›®å½•è§„åˆ™ï¼ˆTxtTocRuleï¼‰ï¼šè‡ªå®šä¹‰è§„åˆ™ã€å¯¼å…¥é»˜è®¤è§„åˆ™ã€ç½‘ç»œå¯¼å…¥ï¼›è‡ªåŠ¨è¯†åˆ«å¼€å…³ï¼›è¶…é•¿ç« èŠ‚è‡ªåŠ¨æ‹†åˆ†ï¼ˆå¸®åŠ©é¡µ `txtTocRuleHelp.md`ï¼‰ã€‚
- WebDav ä¹¦ç±ï¼šä¸Šä¼ /ä¸‹è½½ã€è·¨è®¾å¤‡åŒæ­¥ä¹¦ç±æ–‡ä»¶ä¸è¿›åº¦ï¼ˆå¸®åŠ©é¡µ `webDavBookHelp.md`ï¼‰ã€‚

#### I. è®¢é˜… / RSS

- è®¢é˜…æºï¼ˆRssSourceï¼‰ï¼šè§„åˆ™è®¢é˜…ä»»æ„ç½‘ç»œå†…å®¹ï¼›æœ¬åœ°/ç½‘ç»œ/äºŒç»´ç å¯¼å…¥ä¸åˆ†äº«ï¼ˆå¸®åŠ©é¡µ `SourceMRssHelp.md`ï¼‰ã€‚
- é˜…è¯»ä¸ç®¡ç†ï¼šè®¢é˜…/æ–‡ç« åˆ—è¡¨ã€æ”¶è—ã€é˜…è¯»è®°å½•ï¼›è®¢é˜…é˜…è¯»é¡µæ”¯æŒ JS æ‹¦æˆªè·³è½¬å¹¶è”åŠ¨â€œæœç´¢/åŠ å…¥ä¹¦æ¶â€ç­‰èƒ½åŠ›ï¼ˆå¸®åŠ©é¡µ `jsHelp.md`ï¼‰ã€‚

#### J. å¤‡ä»½ä¸åŒæ­¥

- æœ¬åœ°å¤‡ä»½ä¸æ¢å¤ã€‚
- WebDav äº‘å¤‡ä»½ï¼šè‡ªåŠ¨å¤‡ä»½ï¼ˆé€€å‡ºè§¦å‘/åŒæ—¥è¦†ç›–/è·¨æ—¥ä¿ç•™ï¼‰ã€æ¢å¤é€‰æ‹©å†å²å¤‡ä»½ï¼ˆå¸®åŠ©é¡µ `webDavHelp.md` ä¸ `appHelp.md`ï¼‰ã€‚

#### K. å¯¹å¤–æ¥å£ä¸ Web ç«¯

- URL Schemeï¼š`legado://import/{path}?src={url}`ï¼Œæ”¯æŒå¯¼å…¥ `bookSource` / `rssSource` / `replaceRule` / `textTocRule` / `httpTTS` / `theme` / `readConfig` / `dictRule` / `addToBookshelf` ç­‰ï¼ˆè§ `../legado/README.md`ï¼‰ã€‚
- Web æœåŠ¡ï¼ˆHTTP + WebSocketï¼‰ä¸ Content Providerï¼šä¹¦æº/è®¢é˜…æº/æ›¿æ¢è§„åˆ™/ä¹¦æ¶/ç« èŠ‚/æ­£æ–‡/å°é¢/å›¾ç‰‡/è¿›åº¦ç­‰ï¼ˆè§ `../legado/api.md`ï¼‰ã€‚
- Web ç«¯ï¼ˆVue3ï¼‰ï¼šWeb ä¹¦æ¶ã€Web ä¹¦æºç¼–è¾‘ã€Web è®¢é˜…æºç¼–è¾‘ï¼ˆè§ `../legado/modules/web/README.md`ï¼‰ã€‚

### 2.2 shadcn_ui æ–‡æ¡£è¦ç‚¹ï¼ˆllms.txtï¼‰

æ¥æºï¼š`https://mariuti.com/flutter-shadcn-ui/llms.txt`

- å®‰è£…ï¼š`flutter pub add shadcn_ui`
- æ¨èé›†æˆï¼š`ShadApp.custom` + `CupertinoApp`/`CupertinoApp.router` + `ShadAppBuilder`
- å›½é™…åŒ–å§”æ‰˜ï¼šè¡¥é½ `DefaultMaterialLocalizations`ã€`DefaultCupertinoLocalizations`ã€`DefaultWidgetsLocalizations`
- ä¸»é¢˜ç­–ç•¥ï¼š`ShadThemeData` + äº®/æš—ä¸»é¢˜ + `ShadColorScheme`
- ç»„ä»¶è¦†ç›–ï¼šè¡¨å•ã€å¼¹å±‚ã€å¯¼èˆªã€è¡¨æ ¼ã€Tabsã€Toastã€Sheetã€Dialogã€Selectã€Inputã€Slider ç­‰ï¼Œè¶³ä»¥è¦†ç›–é˜…è¯»å™¨é…ç½®å’Œä¹¦æºç®¡ç†åœºæ™¯ã€‚

### 2.3 å¼€å‘è§„èŒƒï¼ˆLegado å¯¹ç…§ä¼˜å…ˆï¼‰

> æœ¬è§„èŒƒä¸ºå½“å‰é˜¶æ®µå¼ºåˆ¶æµç¨‹ï¼š**å…ˆå¯¹ç…§ legado æºç ï¼Œå†åœ¨æœ¬é¡¹ç›®å®ç°**ã€‚

1. åŠŸèƒ½å¼€å§‹å‰ï¼šå…ˆåœ¨ `../legado` å®šä½å¯¹åº”å®ç°ï¼ˆè‡³å°‘è¦†ç›– UI å…¥å£ + æ ¸å¿ƒé€»è¾‘ï¼‰ã€‚
2. æ–¹æ¡ˆè®¾è®¡æ—¶ï¼šå…ˆè®°å½• legado çš„è¡Œä¸ºè¾¹ç•Œï¼ˆè¾“å…¥ã€çŠ¶æ€ã€å¼‚å¸¸ã€æŒä¹…åŒ–ï¼‰ã€‚
3. ç¼–ç å®ç°æ—¶ï¼šæŒ‰â€œè¡Œä¸ºä¸€è‡´ä¼˜å…ˆã€å®ç°å¯ç®€åŒ–â€åŸåˆ™è½åœ°ï¼›è‹¥æœ‰ç®€åŒ–éœ€æ˜ç¡®æ ‡æ³¨ã€‚
4. å®Œæˆåè‡ªæ£€ï¼šè¡¥ä¸€æ¡â€œæºç å¯¹ç…§è®°å½•â€ï¼ˆå¯¹åº”æ–‡ä»¶ã€å½“å‰å·®å¼‚ã€æ˜¯å¦æ¥å—ï¼‰ã€‚
5. æäº¤å‰å›å½’ï¼šå¯¹æœ¬æ¬¡æ¶‰åŠæ¨¡å—é€é¡¹å¤æ ¸ï¼Œé¿å…å‡ºç°â€œæœªå¯¹ç…§å…ˆå®ç°â€ã€‚

å¯¹ç…§è®°å½•æ¨¡æ¿ï¼ˆæ¯ä¸ªåŠŸèƒ½è‡³å°‘ä¸€æ¡ï¼‰ï¼š

- åŠŸèƒ½åç§°ï¼š
- legado æºç ä½ç½®ï¼š
- æœ¬é¡¹ç›®å®ç°ä½ç½®ï¼š
- ä¸€è‡´ç‚¹ï¼š
- å·®å¼‚ç‚¹ï¼ˆè‹¥æœ‰ï¼‰ï¼š
- å¤„ç†ç»“è®ºï¼ˆä¿®å¤ / æ¥å—å¹¶è®°å½•åŸå› ï¼‰ï¼š

---

## 3. æ€»ä½“æ¶æ„è®¾è®¡

## 3.1 æ¶æ„åŸåˆ™

- **Feature First**ï¼šæŒ‰ä¸šåŠ¡åŸŸæ‹†åˆ†æ¨¡å—ï¼Œè€Œéçº¯æŒ‰æŠ€æœ¯å±‚æ‹†åˆ†ã€‚
- **Clean + Vertical Slice**ï¼šæ¯ä¸ª feature å†…å« `presentation/domain/data`ï¼Œé™ä½è·¨ç›®å½•è·³è½¬æˆæœ¬ã€‚
- **å¯æ›¿æ¢åŸºç¡€è®¾æ–½**ï¼šæ•°æ®åº“ã€JS å¼•æ“ã€ç½‘ç»œå±‚éƒ½é€šè¿‡æŠ½è±¡æ¥å£éš”ç¦»ã€‚
- **å…¼å®¹ä¼˜å…ˆ**ï¼šä¼˜å…ˆå…¼å®¹ legado ä¹¦æº JSON ç»“æ„ä¸æ ¸å¿ƒè§„åˆ™å­—æ®µã€‚

### 3.2 å»ºè®®ç›®å½•ï¼ˆç›®æ ‡æ€ï¼‰

```text
lib/
  app/
    app.dart
    router.dart
    theme/
  bootstrap/
    bootstrap.dart
  core/
    constants/
    errors/
    utils/
    network/
    storage/
    parser/
    js_engine/
  shared/
    widgets/
    extensions/
  features/
    bookshelf/
      presentation/
      domain/
      data/
    source_management/
      presentation/
      domain/
      data/
    discovery_search/
      presentation/
      domain/
      data/
    reader/
      presentation/
      domain/
      data/
    rss/
    settings/
    import_export/
    sync_api/
```

### 3.3 æŠ€æœ¯é€‰å‹ï¼ˆé¦–é€‰ï¼‰

- UIï¼š`shadcn_ui`ï¼ˆä¸»ï¼‰+ `Cupertino`ï¼ˆå®¿ä¸»ï¼‰
- çŠ¶æ€ç®¡ç†ï¼š`riverpod`ï¼ˆå»ºè®® `flutter_riverpod` + `riverpod_generator`ï¼‰
- è·¯ç”±ï¼š`go_router`
- ç½‘ç»œï¼š`dio`
- æœ¬åœ°æ•°æ®åº“ï¼š`drift`ï¼ˆSQLiteï¼Œæ”¯æŒè¿ç§»ä¸å¤æ‚æŸ¥è¯¢ï¼‰
- JSON åºåˆ—åŒ–ï¼š`freezed` + `json_serializable`
- æœ¬åœ°ç¼“å­˜ï¼š`shared_preferences` / `hive`ï¼ˆè½»é‡é…ç½®ï¼‰
- æ–‡æœ¬/è§„åˆ™è§£æï¼š`html`ã€XPath/JsonPath å¯¹åº” Dart åº“ï¼ˆéœ€ PoC éªŒè¯ï¼‰
- JS æ‰§è¡Œï¼šQuickJS/flutter_js å€™é€‰ï¼ˆéœ€ PoC éªŒè¯ä¸æ€§èƒ½å‹æµ‹ï¼‰

> è¯´æ˜ï¼šè§„åˆ™å¼•æ“ï¼ˆXPath/JsonPath/JSï¼‰æ˜¯æŠ€æœ¯é£é™©æœ€é«˜æ¨¡å—ï¼Œå¿…é¡»åœ¨ P1 é˜¶æ®µå®Œæˆå¯è¡Œæ€§éªŒè¯å†å¤§è§„æ¨¡æ¨è¿›ã€‚

---

## 4. legado åˆ° Flutter çš„æ¨¡å—æ˜ å°„

| legado æ¨¡å— | Flutter å¯¹åº”æ¨¡å— | è¯´æ˜ |
|---|---|---|
| `data/entities/*` | `features/*/domain/models` + `data/dtos` | ä¿æŒé¢†åŸŸæ¨¡å‹ç¨³å®šï¼ŒDTO åšå…¼å®¹è½¬æ¢ |
| `data/dao/*` + Room | `features/*/data/local` + Drift | æŒ‰ feature æ‹†è¡¨ä¸ DAO |
| `model/webBook/*` | `features/discovery_search/domain/services` | æœç´¢ã€ä¹¦ç±è¯¦æƒ…ã€ç›®å½•ã€æ­£æ–‡æŠ“å– |
| `help/source/*` | `core/parser` + `core/js_engine` | è§„åˆ™è§£æå’Œæ‰§è¡Œå†…æ ¸ |
| `ui/main/bookshelf` | `features/bookshelf/presentation` | ä¹¦æ¶ã€åˆ†ç»„ã€æ’åºã€æœ€è¿‘é˜…è¯» |
| `ui/book/read/*` | `features/reader/presentation` | é˜…è¯»é¡µã€ç¿»é¡µã€æ ·å¼ã€èœå•ã€TTS |
| `ui/book/source` | `features/source_management/presentation` | ä¹¦æºå¢åˆ æ”¹æŸ¥ã€åˆ†ç»„ã€å¯¼å…¥ |
| `api/controller/*` + `web/*` | `features/sync_api` | æœ¬åœ° API / WebSocketï¼ˆåç½®é˜¶æ®µï¼‰ |

---

## 5. åˆ†é˜¶æ®µå®æ–½è®¡åˆ’ï¼ˆPlan Modeï¼‰

## P0ï¼šå·¥ç¨‹åˆå§‹åŒ–ï¼ˆ1-2 å¤©ï¼Œå·²å®Œæˆï¼‰

ç›®æ ‡ï¼šå¾—åˆ°å¯è¿è¡Œçš„ Flutter é¡¹ç›®éª¨æ¶ + Shadcn ä¸»é¢˜åŸºåº§

- åˆå§‹åŒ–å·¥ç¨‹ã€ç›®å½•ã€ç¯å¢ƒé…ç½®ï¼ˆdev/prodï¼‰
- æ¥å…¥ `shadcn_ui`ï¼Œä½¿ç”¨ `ShadApp.custom + CupertinoApp.router`
- å»ºç«‹ä¸»é¢˜ç³»ç»Ÿï¼ˆäº®/æš—ã€å­—ä½“ã€åŸºç¡€ tokenï¼‰
- å»ºç«‹è·¯ç”±ä¸å£³å±‚é¡µé¢ï¼ˆä¹¦æ¶/å‘ç°/é˜…è¯»/è®¾ç½®ç©ºé¡µé¢ï¼‰

äº¤ä»˜æ ‡å‡†ï¼š

- `flutter run` å¯å¯åŠ¨
- ä¸»é¢˜åˆ‡æ¢å¯ç”¨
- è·¯ç”±è·³è½¬å¯ç”¨

## P1ï¼šåŸºç¡€èƒ½åŠ›å±‚ï¼ˆ3-5 å¤©ï¼Œå·²å®Œæˆï¼‰

ç›®æ ‡ï¼šæ„å»ºé•¿æœŸå¯ç»´æŠ¤åº•åº§

- ç½‘ç»œå±‚ï¼ˆDio + æ‹¦æˆªå™¨ + é”™è¯¯æ¨¡å‹ï¼‰
- æœ¬åœ°å­˜å‚¨ï¼ˆDrift è¡¨ç»“æ„ v1ï¼šBookã€BookSourceã€BookChapterã€ReadRecordã€Bookmarkï¼‰
- é…ç½®ä¸­å¿ƒï¼ˆé˜…è¯»è®¾ç½®ã€ä¸»é¢˜è®¾ç½®ã€å®éªŒå¼€å…³ï¼‰
- è§„åˆ™å¼•æ“ PoCï¼ˆHTML/XPath/JsonPath/JS æœ€å°é—­ç¯ï¼‰

äº¤ä»˜æ ‡å‡†ï¼š

- èƒ½ä»æœ¬åœ°æ ·ä¾‹è§„åˆ™è§£æå‡ºä¹¦åã€ç›®å½•ã€æ­£æ–‡
- è¡¨ç»“æ„å¯è¿ç§»ï¼ˆè‡³å°‘ 1 æ¬¡ migration æ¼”ç»ƒï¼‰

## P2ï¼šä¹¦æºä¸æœç´¢ï¼ˆ4-7 å¤©ï¼ŒåŸºç¡€é—­ç¯å·²å®Œæˆï¼‰

ç›®æ ‡ï¼šæ‰“é€šâ€œæ‰¾ä¹¦â€é“¾è·¯

- ä¹¦æºç®¡ç†ï¼šå¯¼å…¥ã€å¯åœã€åˆ†ç»„ã€ç¼–è¾‘
- æœç´¢é¡µï¼šå…³é”®è¯æœç´¢ã€æ¥æºç­›é€‰ã€ç»“æœèšåˆ
- ä¹¦ç±è¯¦æƒ…ï¼šç®€ä»‹ã€ç›®å½•é¢„è§ˆã€åŠ å…¥ä¹¦æ¶
- é”™è¯¯å¯è§‚æµ‹ï¼šè¶…æ—¶ã€è§„åˆ™å¼‚å¸¸ã€è§£æå¤±è´¥æç¤º

äº¤ä»˜æ ‡å‡†ï¼š

- è‡³å°‘ 1-2 ä¸ªçœŸå®ä¹¦æºå¯ç¨³å®šæœç´¢/æ‹‰å–ç›®å½•
- åŠ å…¥ä¹¦æ¶åå¯ç¦»çº¿ä¿ç•™å…ƒæ•°æ®

## P3ï¼šé˜…è¯»æ ¸å¿ƒï¼ˆ5-8 å¤©ï¼ŒåŸºç¡€é—­ç¯å·²å®Œæˆï¼‰

ç›®æ ‡ï¼šæ‰“é€šâ€œçœ‹ä¹¦â€é“¾è·¯

- é˜…è¯»é¡µï¼šç« èŠ‚åŠ è½½ã€è¿›åº¦ä¿å­˜ã€ä¸Šä¸‹ç« è·³è½¬
- é˜…è¯»é…ç½®ï¼šå­—ä½“/è¡Œè·/è¾¹è·/ä¸»é¢˜/ç¿»é¡µæ¨¡å¼
- æ–‡æœ¬å‡€åŒ–ï¼šæ›¿æ¢è§„åˆ™å¯åœã€é¢„è§ˆ
- ä¹¦ç­¾ä¸é˜…è¯»å†å²

äº¤ä»˜æ ‡å‡†ï¼š

- ä¹¦æ¶ -> é˜…è¯» -> é€€å‡º -> æ¢å¤è¿›åº¦å®Œæ•´é—­ç¯
- é˜…è¯»é…ç½®å®æ—¶ç”Ÿæ•ˆ

## P4ï¼šå¢å¼ºèƒ½åŠ›ï¼ˆå¹¶è¡Œ/åç»­ï¼‰

- æœ¬åœ° TXT/EPUB å¯¼å…¥
- RSS è®¢é˜…ä¸é˜…è¯»
- TTS æœ—è¯»ï¼ˆå¹³å°èƒ½åŠ› + å¯æ‰©å±•å¼•æ“ï¼‰
- WebDAV/äº‘åŒæ­¥
- æœ¬åœ° Web API / WebSocketï¼ˆå…¼å®¹ legado å¸¸ç”¨æ¥å£ï¼‰

---

## 6. Shadcn ç»„ä»¶è½ä½å»ºè®®

- ä¹¦æ¶ï¼š`ShadTabs` + `ShadCard` + `ShadContextMenu`
- æœç´¢ï¼š`ShadInput` + `ShadSelect` + `ShadButton` + `ShadTable`
- é˜…è¯»è®¾ç½®ï¼š`ShadSheet` + `ShadSlider` + `ShadSwitch` + `ShadRadioGroup`
- å¼¹çª—äº¤äº’ï¼š`ShadDialog` / `ShadPopover` / `ShadToast`
- è¡¨å•åœºæ™¯ï¼ˆä¹¦æºç¼–è¾‘ï¼‰ï¼š`ShadForm` + æ ¡éªŒè§„åˆ™

---

## 7. é£é™©ä¸å¯¹ç­–

- è§„åˆ™å¼•æ“å…¼å®¹é£é™©é«˜ï¼šå…ˆåšæœ€å°è§„åˆ™å­é›†ï¼ˆæœç´¢/ç›®å½•/æ­£æ–‡ï¼‰ï¼Œé€æ­¥æ‰©å±•ã€‚
- Flutter ç«¯ JS æ€§èƒ½ä¸å®‰å…¨ï¼šé™åˆ¶è„šæœ¬æ‰§è¡Œè¶…æ—¶ã€å†…å­˜ã€å¹¶å‘ï¼›åŠ å…¥ç†”æ–­ä¸é™çº§ã€‚
- å¤šæºèšåˆç¨³å®šæ€§ï¼šè¯·æ±‚å¹¶å‘ä¸Šé™ã€é‡è¯•ã€æ–­è·¯å™¨ã€æºå¥åº·è¯„åˆ†ã€‚
- é˜…è¯»ä½“éªŒç»†èŠ‚å¤æ‚ï¼šå…ˆä¿æ ¸å¿ƒï¼ˆåˆ†é¡µ/è¿›åº¦/æ ·å¼ï¼‰ï¼Œé«˜çº§åŠ¨æ•ˆåç½®ã€‚

---

## 8. è¿‘æœŸæ‰§è¡Œæ¸…å•ï¼ˆä¸»æµç¨‹ä¼˜å…ˆï¼‰

### 8.1 ä¸»æµç¨‹ï¼ˆå…ˆå®Œæˆï¼‰

1. æ‰“é€šæ‰¾ä¹¦ä¸»é“¾è·¯ï¼šå‘ç°æœç´¢ -> ä¹¦ç±è¯¦æƒ…ï¼ˆ`ruleBookInfo`ï¼‰-> åŠ å…¥ä¹¦æ¶ -> æ‰“å¼€é˜…è¯»ã€‚
2. ç¨³å®šé˜…è¯»ä¸»é“¾è·¯ï¼šä¹¦æ¶æ‰“å¼€ -> ç›®å½•/æ­£æ–‡åŠ è½½ -> è¿›åº¦å†™å›ä¸æ¢å¤ã€‚
3. å·©å›ºé˜…è¯»é—­ç¯ï¼šé˜…è¯»å™¨æ ¸å¿ƒè®¾ç½® + å…¨æ–‡æœç´¢ + ä¹¦ç­¾/å†å²ã€‚

### 8.2 ä¸»æµç¨‹å®Œæˆåï¼ˆå†åšç»†èŠ‚ä¼˜åŒ–ï¼‰

1. è§„åˆ™å¼•æ“æ·±åº¦å¯¹é½ï¼šXPath/JsonPath/JS å…¨é‡ä¸è°ƒè¯•èƒ½åŠ›ã€‚
2. é˜…è¯»ä½“éªŒç»†èŠ‚ï¼šè¦†ç›–åˆ†é¡µç²¾åº¦ã€åŠ¨ç”»ç»†èŠ‚ã€èœå•äº¤äº’ä¸€è‡´æ€§ã€‚
3. èƒ½åŠ›æ‰©å±•ï¼šæœ¬åœ°ä¹¦å¯¼å…¥ã€ç¦»çº¿ç¼“å­˜ã€å¯¼å‡ºã€åŒæ­¥ä¸æ¥å£ç”Ÿæ€ã€‚

---

## 9. éªŒæ”¶åŸºçº¿ï¼ˆMVPï¼‰

- å¯å¯¼å…¥ä¹¦æºå¹¶æœç´¢åˆ°ä¹¦ã€‚
- å¯åŠ å…¥ä¹¦æ¶å¹¶æ‰“å¼€é˜…è¯»ã€‚
- å¯ä¿å­˜/æ¢å¤é˜…è¯»è¿›åº¦ã€‚
- å¯ä¿®æ”¹é˜…è¯»ä¸»é¢˜å’Œæ–‡æœ¬æ ·å¼ã€‚
- æ ¸å¿ƒé¡µé¢å…¨éƒ¨é‡‡ç”¨ shadcn é£æ ¼ç»„ä»¶ã€‚

---

## 10. å¯¹æ ‡ Legado TODO Backlogï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰

> ä½¿ç”¨æ–¹å¼ï¼šæŠŠæœ¬èŠ‚å½“ä½œâ€œäº§å“å¾…åŠæ± â€ï¼Œä»¥ Legado åŠŸèƒ½æ¸…å•ä¸ºå‚ç…§ï¼›å®ç°è¿‡ç¨‹ä¸­å†æ‹†æˆæ›´ç»†çš„ Issue/ä»»åŠ¡å¡ã€‚
>
> çŠ¶æ€çº¦å®šï¼š`[x]` å·²å®Œæˆï¼Œ`[ ]` æœªå®Œæˆï¼ˆå¯åœ¨æ¡ç›®åè¿½åŠ â€œè¿›è¡Œä¸­/é˜»å¡/ä¾èµ–â€ï¼‰ã€‚

### P0ï¼šè¯»å†™é—­ç¯ï¼ˆå½“å‰å·²å…·å¤‡é›å½¢ï¼‰

- [x] å·¥ç¨‹éª¨æ¶ï¼š`Shadcn + Cupertino` å®¿ä¸»ã€`go_router` å›› tab å£³å±‚ã€‚
- [x] ç½‘ç»œå±‚ï¼š`dio` + åŸºç¡€ç½‘å…³ï¼ˆå« `mock://` æ¼”ç¤ºæ¥å£ï¼‰ã€‚
- [x] æ•°æ®å±‚ï¼š`drift`ï¼ˆ`Book` / `BookSource` / `BookChapter`ï¼‰+ è¿ç§»åˆ° `schemaVersion=3`ã€‚
- [x] ä¹¦æºå¯¼å…¥ï¼šå…¼å®¹ Legado ä¹¦æº JSONï¼ˆæ‰¹é‡å¯¼å…¥ + å­—æ®µå®¹é”™ï¼‰ã€‚
- [x] æ‰¾ä¹¦ï¼šæœç´¢è§„åˆ™åŸºç¡€è§£æï¼ˆJSON + HTML/CSS å­é›†ï¼‰+ èšåˆæœç´¢æœåŠ¡ã€‚
- [x] é˜…è¯»æœ€å°é“¾è·¯ï¼šå‘ç°é¡µæœç´¢ -> åŠ å…¥ä¹¦æ¶ -> ç›®å½•/æ­£æ–‡æŠ“å– -> é˜…è¯»é¡µå±•ç¤ºï¼ˆ`ruleToc` / `ruleContent` çš„åŸºç¡€è·¯å¾„è§£æï¼‰ã€‚
- [x] ä¹¦æ¶é¡µæ¥å…¥çœŸå®æ•°æ®ï¼ˆå½“å‰ä¸ºå ä½å¡ç‰‡ï¼‰ï¼Œè‡³å°‘æ”¯æŒâ€œæœ€è¿‘é˜…è¯»æ’åº/æ‰“å¼€é˜…è¯»â€ã€‚
- [x] é˜…è¯»è¿›åº¦å†™å›ï¼ˆ`durChapterIndex/durChapterPos/durChapterTime`ï¼‰å¹¶åœ¨è¿›å…¥é˜…è¯»æ—¶æ¢å¤ã€‚

### P1ï¼šè§„åˆ™å¼•æ“å¯¹é½ï¼ˆå½“å‰ä¸»æ”»ï¼‰

- [ ] ç»Ÿä¸€è§„åˆ™æ¨¡å‹ä¸æ‰§è¡Œå™¨ï¼šåŒä¸€å¥—è§£æ/æ‰§è¡Œè¦†ç›– `ruleSearch/ruleBookInfo/ruleToc/ruleContent/ruleExplore`ã€‚
- [ ] XPath å…¨é‡æ”¯æŒï¼ˆå«å¸¸ç”¨å‡½æ•°/è½´/è°“è¯­ï¼›ä¸ Legado è§„åˆ™æ ‡å¿—å…¼å®¹ï¼‰ã€‚
- [ ] JsonPath å…¨é‡æ”¯æŒï¼ˆè€Œä¸æ˜¯å½“å‰çš„ç‚¹è·¯å¾„å­é›†ï¼‰ã€‚
- [ ] JS æ‰§è¡Œèƒ½åŠ›ï¼ˆæ›¿ä»£ Rhinoï¼‰ï¼šæä¾›è¶…æ—¶/å†…å­˜/å¹¶å‘é™åˆ¶ä¸æœ€å° `java.*` bridgeï¼ˆä»¥æ»¡è¶³å¸¸è§ä¹¦æºï¼‰ã€‚
- [ ] URL è§„åˆ™èƒ½åŠ›ï¼šmethod/headers/bodyã€é‡å®šå‘å¤„ç†ã€åŠ¨æ€å‚æ•°ã€å›¾ç‰‡è¯·æ±‚ headersã€‚
- [ ] CookieJarï¼šæŒ‰ä¹¦æºæŒä¹…åŒ– cookieï¼Œæ”¯æŒç™»å½•æ€ä¸éªŒè¯ç åœºæ™¯ã€‚
- [ ] å¹¶å‘ä¸é™æµï¼šæ”¯æŒæ¯æº `concurrentRate` + å…¨å±€å¹¶å‘ä¸Šé™ï¼›å¤±è´¥é‡è¯•ä¸ç†”æ–­/é™çº§ç­–ç•¥ã€‚
- [ ] è°ƒè¯•èƒ½åŠ›ï¼šä¹¦æºè°ƒè¯•å…¥å£ï¼ˆæœç´¢/å‘ç°/è¯¦æƒ…/ç›®å½•/æ­£æ–‡ï¼‰+ å¯è¯»é”™è¯¯æç¤ºï¼ˆè§„åˆ™/JS/ç½‘ç»œ/è§£æï¼‰ã€‚

### P2ï¼šä¹¦æ¶ä¸é˜…è¯»å™¨ä½“éªŒï¼ˆäº§å“å±‚é¢â€œå¯ç”¨â€ï¼‰

- [ ] ä¹¦æºç®¡ç† UIï¼šåˆ—è¡¨/ç­›é€‰/åˆ†ç»„/å¯ç”¨ç¦ç”¨/å¯¼å…¥å¯¼å‡º/åˆ†äº«ï¼ˆå…ˆåšâ€œç®¡ç†â€ï¼Œé«˜çº§æ ¡éªŒ/è°ƒè¯•å¯åç½®ï¼‰ã€‚
- [x] ä¹¦ç±è¯¦æƒ…æµï¼ˆ`ruleBookInfo`ï¼‰ï¼šç®€ä»‹/å°é¢/ä½œè€…/ç›®å½•é¢„è§ˆï¼›åŠ å…¥/ç§»é™¤ä¹¦æ¶ï¼›æ¢æºå…¥å£ã€‚
- [x] ç›®å½•é¡µï¼šç« èŠ‚åˆ—è¡¨ã€å¿«é€Ÿè·³è½¬ã€å·/åˆ†ç»„ï¼ˆå¯é€‰ï¼‰ã€ç¼“å­˜çŠ¶æ€æç¤ºã€‚
- [x] é˜…è¯»å™¨åˆ†é¡µä¸ç¿»é¡µæ¨¡å¼ï¼šè‡³å°‘â€œæ»šåŠ¨ + è¦†ç›–â€ä¸¤ç§ï¼›åç»­è¡¥ä»¿çœŸ/æ»‘åŠ¨ã€‚
- [x] é˜…è¯»æ’ç‰ˆè®¾ç½®ï¼šå­—ä½“/å­—å·/è¡Œè·/æ®µè·/è¾¹è·/ä¸»é¢˜/å¤œé—´/å¯¹é½ç­‰ï¼Œæ”¯æŒæŒä¹…åŒ–ä¸å³æ—¶ç”Ÿæ•ˆã€‚
- [x] ä¹¦ç­¾ä¸é˜…è¯»å†å²ï¼šä¹¦ç­¾å¢åˆ æŸ¥ã€å†å²åˆ—è¡¨ã€ä»å†å²æ¢å¤è¿›åº¦ã€‚
- [x] å…¨æ–‡æœç´¢ï¼šåŸºäºæœ¬åœ°ç¼“å­˜ç« èŠ‚/æœ¬åœ°ä¹¦ç±çš„æœç´¢ï¼ˆä¸æœç´¢åœ¨çº¿å†…å®¹ï¼‰ã€‚
- [x] æ›¿æ¢å‡€åŒ–ï¼ˆReplaceRuleï¼‰ï¼šè§„åˆ™ç®¡ç†ï¼ˆåˆ†ç»„/æ’åº/å¯ç”¨ï¼‰+ æ›¿æ¢å¼•æ“ï¼ˆå«æ­£åˆ™ï¼‰+ é¢„è§ˆ/æµ‹è¯•ã€‚
- [ ] å›¾ç‰‡ç« èŠ‚åŸºç¡€æ”¯æŒï¼šæ­£æ–‡ä¸­å›¾ç‰‡æ¸²æŸ“ã€ç®€å•ç¼©æ”¾/æ ·å¼ï¼ˆå¦‚ `full`ï¼‰ç­–ç•¥ï¼ˆå½“å‰èŒƒå›´å¤–ï¼šä»…åšå°è¯´æ–‡æœ¬é˜…è¯»ï¼Œæš‚ä¸æ”¯æŒï¼‰ã€‚

### P3ï¼šç¦»çº¿ã€æœ¬åœ°ä¹¦ã€å¯¼å‡ºï¼ˆèƒ½åŠ›è¡¥å…¨ï¼‰

- [ ] ç¦»çº¿ç¼“å­˜ï¼šæŒ‰ç« èŠ‚æ‰¹é‡ä¸‹è½½ã€å¹¶å‘æ§åˆ¶ã€ç¼“å­˜ç®¡ç†é¡µï¼ˆæ¸…ç†/èŒƒå›´/å¤±è´¥é‡è¯•ï¼‰ã€‚
- [ ] å¯¼å‡ºï¼šå¯¼å‡º TXT/EPUBï¼ˆå«è‡ªå®šä¹‰å‘½åè§„åˆ™ï¼‰ï¼›å¯é€‰â€œå¯¼å‡ºåˆ° WebDavâ€ã€‚
- [ ] æœ¬åœ°ä¹¦ï¼šTXT/EPUB å¯¼å…¥ï¼ˆæ–‡ä»¶é€‰æ‹©/æ‰«æï¼‰ï¼›ä¹¦æ¶ä¸­åŒºåˆ†æœ¬åœ°ä¸åœ¨çº¿ä¹¦ã€‚
- [ ] TXT ç›®å½•è§„åˆ™ï¼ˆTxtTocRuleï¼‰ï¼šè§„åˆ™ç®¡ç†ã€è‡ªåŠ¨è¯†åˆ«å¼€å…³ã€ç½‘ç»œå¯¼å…¥ã€è¶…é•¿ç« èŠ‚æ‹†åˆ†ã€‚
- [ ] ä¹¦ç±å­˜å‚¨ä½ç½®è®¾ç½®ï¼šå…¼å®¹ Android å­˜å‚¨æƒé™/åˆ†åŒºå­˜å‚¨ï¼›iOS æ–‡ä»¶è®¿é—®ç­–ç•¥ã€‚

### P4ï¼šè®¢é˜…ã€åŒæ­¥ã€å¯¹å¤–æ¥å£ï¼ˆç”Ÿæ€èƒ½åŠ›ï¼‰

- [ ] RSS/è®¢é˜…ï¼šè®¢é˜…æºç®¡ç†ï¼ˆå¯¼å…¥/å¯åœ/å¯¼å‡º/åˆ†äº«ï¼‰ã€æ–‡ç« åˆ—è¡¨/é˜…è¯»/æ”¶è—/è®°å½•ã€‚
- [ ] å¬ä¹¦ï¼šç³»ç»Ÿ TTS + åå°æœ—è¯»ï¼›åœ¨çº¿æœ—è¯»å¼•æ“ï¼ˆHttpTTS è§„åˆ™ï¼š`speakText/speakSpeed`ï¼‰ã€‚
- [ ] å­—å…¸/ç¿»è¯‘ï¼šé€‰æ‹©æ–‡å­—èœå• + DictRuleï¼ˆ`urlRule` + `showRule`ï¼‰ã€‚
- [ ] å¤‡ä»½ä¸æ¢å¤ï¼šæœ¬åœ°å¤‡ä»½ï¼›WebDav äº‘å¤‡ä»½ï¼ˆè‡ªåŠ¨å¤‡ä»½ã€å†å²ç®¡ç†ã€æ¢å¤é€‰æ‹©ï¼‰ã€‚
- [ ] æœ¬åœ° Web API / WebSocketï¼šä¼˜å…ˆå…¼å®¹ Legado å¸¸ç”¨æ¥å£ï¼ˆä¹¦æº/ä¹¦æ¶/ç« èŠ‚/æ­£æ–‡/è¿›åº¦/æ›¿æ¢è§„åˆ™ï¼‰ã€‚
- [ ] URL Schemeï¼šå…¼å®¹ `legado://import/{path}?src=...` çš„æ ¸å¿ƒå¯¼å…¥ç±»å‹ï¼ˆbookSource/rssSource/replaceRule/textTocRule/httpTTS/theme/readConfig/dictRule/addToBookshelfï¼‰ã€‚
- [ ] Web ç«¯ï¼šWeb ä¹¦æ¶ + Web æºç¼–è¾‘ï¼ˆä¾èµ–æœ¬åœ° API å…ˆè½åœ°ï¼›å¯é€‰ï¼‰ã€‚

### å¯é€‰/ä½ä¼˜å…ˆçº§ï¼ˆè§†ç›®æ ‡ä¸èµ„æºè£å‰ªï¼‰

- [ ] ä¹¦æºâ€œæ ¡éªŒâ€å®Œæ•´å¯¹é½ï¼ˆç»†åˆ†å¤±è´¥åŸå› ã€è‡ªåŠ¨ç­›é€‰å¤±æ•ˆæºã€æ ¡éªŒå…³é”®è¯ç­–ç•¥ï¼‰ã€‚
- [ ] ç™»å½• UI/éªŒè¯ç /å†…ç½®æµè§ˆå™¨ï¼ˆWebViewï¼‰æ·±åº¦å¯¹é½ï¼ˆè§„åˆ™å¯è°ƒç”¨æµè§ˆå™¨ç­‰å¾…ç»“æœï¼‰ã€‚
- [ ] ä»£ç†é…ç½® UIï¼ˆHTTP/Socksï¼‰ã€è´­ä¹°/è·³è½¬ç­‰è¾¹ç¼˜è§„åˆ™æ‰©å±•ã€‚
- [ ] å­—ä½“åæ··æ·†ã€å›¾ç‰‡/å°é¢è§£å¯†ç­‰é«˜çº§è§„åˆ™æ‰©å±•ï¼ˆåªåœ¨é‡åˆ°çœŸå®ä¹¦æºå¼ºä¾èµ–æ—¶ä¼˜å…ˆå®ç°ï¼‰ã€‚

---

## 11. å·²å®ç°æ¨¡å—å¯¹ç…§å®¡æŸ¥ï¼ˆ2026-02-11ï¼‰

> ç›®æ ‡ï¼šæŒ‰â€œå‰é¢æ¨¡å—ä¸€ä¸ªä¸€ä¸ªè¿‡ä¸€éâ€æ‰§è¡Œæºç å¯¹ç…§å®¡æŸ¥ï¼›å½“å‰é˜¶æ®µåªè¦†ç›–**æ–‡æœ¬å°è¯´**èŒƒå›´ã€‚

### 11.1 ä¹¦æ¶ï¼ˆBookshelfï¼‰

- legado å¯¹ç…§ï¼š
  - `../legado/app/src/main/java/io/legado/app/ui/main/bookshelf/style2/BooksAdapterList.kt`
  - `../legado/app/src/main/java/io/legado/app/ui/main/bookshelf/BookshelfViewModel.kt`
- å½“å‰ç»“è®ºï¼šå·²å®ç°â€œæœ€è¿‘é˜…è¯»æ’åº + ç»§ç»­é˜…è¯» + ç§»é™¤â€ï¼›æœªåšåˆ†ç»„ã€æœªè¯»è§’æ ‡ã€æ›´æ–°ä¸­åŠ¨ç”»ã€‚
- å¤„ç†ï¼šç°é˜¶æ®µæ¥å—å·®å¼‚ï¼ˆMVP å¯ç”¨ï¼‰ï¼Œåç»­åœ¨ P2 è¡¥é½åˆ†ç»„ä¸æœªè¯»çŠ¶æ€ã€‚

### 11.2 é˜…è¯»è¿›åº¦å†™å›ä¸æ¢å¤

- legado å¯¹ç…§ï¼š
  - `../legado/app/src/main/java/io/legado/app/model/ReadBook.kt`ï¼ˆ`saveRead()`ï¼‰
- å½“å‰ç»“è®ºï¼šå·²å†™å› `durChapterIndex/durChapterPos/durChapterTime` å¹¶æ¢å¤ï¼›å·²è¡¥é½â€œæœ¬åœ°ç¼“å­˜å‘½ä¸­åˆ†æ”¯â€ä¹Ÿä¼šæ›´æ–°è¿›åº¦ä¸çŠ¶æ€ã€‚
- å¤„ç†ï¼šä¸€è‡´æ€§æ»¡è¶³å½“å‰é˜¶æ®µç›®æ ‡ã€‚

### 11.3 ç›®å½•é¢æ¿

- legado å¯¹ç…§ï¼š
  - `../legado/app/src/main/java/io/legado/app/ui/book/read/ReadMenu.kt`
- å½“å‰ç»“è®ºï¼šå·²æ”¯æŒç« èŠ‚åˆ—è¡¨ã€æ ‡é¢˜æœç´¢ã€é¦–ç« /å½“å‰/æœ«ç« è·³è½¬ã€ç¼“å­˜çŠ¶æ€æç¤ºã€‚
- å¤„ç†ï¼šä¿æŒç°çŠ¶ï¼Œåç»­å†è¡¥æ›´ç»†çš„ç›®å½•åˆ†ç»„ä¸é«˜çº§äº¤äº’ã€‚

### 11.4 é˜…è¯»æ’ç‰ˆä¸èœå•

- legado å¯¹ç…§ï¼š
  - `../legado/app/src/main/java/io/legado/app/ui/book/read/ReadMenu.kt`
- å½“å‰ç»“è®ºï¼šå·²æ”¯æŒä¸»é¢˜ã€å­—å·ã€è¡Œè·ã€äº®åº¦ã€ç‚¹å‡»ç¿»é¡µã€åº•éƒ¨èœå•å¸ƒå±€ä¸æŒä¹…åŒ–ã€‚
- å¤„ç†ï¼šåœ¨â€œä»…å°è¯´â€èŒƒå›´å†…ä¿æŒä¸€è‡´ï¼›æœ—è¯»å…¥å£æš‚ç”±ä¹¦ç­¾å…¥å£æ›¿ä»£å¹¶åœ¨åç»­è¡¥å›ã€‚

### 11.5 ä¹¦ç±è¯¦æƒ…æµï¼ˆruleBookInfoï¼‰

- legado å¯¹ç…§ï¼š
  - `../legado/app/src/main/java/io/legado/app/model/webBook/BookInfo.kt`
  - `../legado/app/src/main/java/io/legado/app/ui/book/info/BookInfoActivity.kt`
  - `../legado/app/src/main/java/io/legado/app/data/entities/rule/BookInfoRule.kt`
- å½“å‰ç»“è®ºï¼šå·²æ‰“é€šâ€œå‘ç° -> è¯¦æƒ… -> å…¥ä¹¦æ¶ -> é˜…è¯»â€ä¸»æµç¨‹ï¼Œæ”¯æŒ `ruleBookInfo` åŸºç¡€å­—æ®µï¼ˆname/author/intro/coverUrl/tocUrlï¼‰è§£æã€‚
- å·®å¼‚ï¼šæœªè¦†ç›– Legado çš„ `init/canReName/kind/lastChapter/wordCount/downloadUrls` ç­‰å®Œæ•´å­—æ®µã€‚
- å¤„ç†ï¼šä¸»æµç¨‹ä¼˜å…ˆï¼Œå…ˆä¿æŒåŸºç¡€å­—æ®µï¼›æ‰©å±•å­—æ®µåç½®åˆ°è§„åˆ™å¼•æ“å¯¹é½é˜¶æ®µã€‚

### 11.6 å…¨æ–‡æœç´¢ï¼ˆæœ¬åœ°ç¼“å­˜ï¼‰

- legado å¯¹ç…§ï¼š
  - `../legado/app/src/main/java/io/legado/app/ui/book/searchContent/SearchContentActivity.kt`
  - `../legado/app/src/main/java/io/legado/app/ui/book/searchContent/SearchContentViewModel.kt`
- å½“å‰ç»“è®ºï¼šå·²æ”¯æŒæŒ‰ç¼“å­˜ç« èŠ‚æœç´¢ã€å‘½ä¸­æ¬¡æ•°ã€ç‰‡æ®µé¢„è§ˆã€ç‚¹å‡»è·³ç« ã€‚
- è¿›å±•æ›´æ–°ï¼šå·²è¡¥é½â€œå‘½ä¸­ä½ç½®é«˜äº® + ç« èŠ‚å†…å‘½ä¸­ç´¢å¼•å®šä½â€ï¼›æ»šåŠ¨æ¨¡å¼ä¸‹æ”¯æŒè·³è½¬åè‡ªåŠ¨æ»šåŠ¨åˆ°ç›®æ ‡å‘½ä¸­ä½ç½®ã€‚
- å·®å¼‚ï¼šè¦†ç›–æ¨¡å¼ä¸‹ä»…åšå…³é”®è¯é«˜äº®ï¼Œä¸åšç²¾ç¡®å‘½ä¸­æ»šåŠ¨å®šä½ï¼ˆå½“å‰é˜¶æ®µå¯æ¥å—ï¼‰ã€‚

### 11.7 æ›¿æ¢å‡€åŒ–ï¼ˆReplaceRuleï¼‰

- legado å¯¹ç…§ï¼š
  - `../legado/app/src/main/java/io/legado/app/help/ReplaceAnalyzer.kt`
  - `../legado/app/src/main/java/io/legado/app/help/book/ContentProcessor.kt`
  - `../legado/app/src/main/java/io/legado/app/ui/book/read/EffectiveReplacesDialog.kt`
- å½“å‰ç»“è®ºï¼šå·²å…·å¤‡è§„åˆ™å¢åˆ ã€å¯åœã€æ­£åˆ™/æ–‡æœ¬æ›¿æ¢ã€å½“å‰ç« é¢„è§ˆã€‚
- å·®å¼‚ï¼šæœªåš scope/group/orderã€æœ‰æ•ˆè§„åˆ™åˆ—è¡¨ä¸å…¨å±€è§„åˆ™ç®¡ç†é¡µã€‚
- å¤„ç†ï¼šä¿ç•™å½“å‰æœ€å°é—­ç¯ï¼Œåç»­é€æ­¥è¡¥é½ã€‚

### 11.8 ä¹¦ç­¾ä¸å†å²

- legado å¯¹ç…§ï¼š
  - `../legado/app/src/main/java/io/legado/app/data/entities/Bookmark.kt`
  - `../legado/app/src/main/java/io/legado/app/data/entities/ReadRecord.kt`
  - `../legado/app/src/main/java/io/legado/app/data/dao/ReadRecordDao.kt`
  - `../legado/app/src/main/java/io/legado/app/ui/book/toc/BookmarkFragment.kt`
- å½“å‰ç»“è®ºï¼šå·²æ”¯æŒä¹¦ç­¾å¢åˆ ä¸å†å²è·³è½¬ï¼›æœ¬è½®æ”¹ä¸ºâ€œæŒ‰ä¹¦éš”ç¦»â€æŒä¹…åŒ–ï¼Œé¿å…è·¨ä¹¦ä¸²æ•°æ®ã€‚
- å·®å¼‚ï¼šå°šæœªå¯¹é½ legado çš„é˜…è¯»æ—¶é•¿ç»Ÿè®¡ä½“ç³»ï¼ˆ`ReadRecord` èšåˆï¼‰ã€‚
- å¤„ç†ï¼šé˜¶æ®µæ€§æ¥å—å·®å¼‚ï¼Œåç»­æ–°å¢ç»Ÿè®¡é¡µæ—¶è¡¥é½ã€‚

### 11.9 ç¿»é¡µæ¨¡å¼ï¼ˆæ»šåŠ¨/è¦†ç›–ï¼‰

- legado å¯¹ç…§ï¼š
  - `../legado/app/src/main/java/io/legado/app/ui/book/read/page/ReadView.kt`
  - `../legado/app/src/main/java/io/legado/app/ui/book/read/page/delegate/CoverPageDelegate.kt`
  - `../legado/app/src/main/java/io/legado/app/ui/book/read/page/delegate/ScrollPageDelegate.kt`
- å½“å‰ç»“è®ºï¼šå·²æä¾›æ»šåŠ¨ + è¦†ç›–ä¸¤ç§å¯åˆ‡æ¢æ¨¡å¼å¹¶æŒä¹…åŒ–ã€‚
- å·®å¼‚ï¼šå½“å‰è¦†ç›–æ¨¡å¼ä¸ºæ–‡æœ¬åˆ‡ç‰‡åˆ†é¡µï¼Œæœªè¾¾åˆ° legado çš„æ¸²æŸ“ä»£ç†çº§åˆ†é¡µç²¾åº¦ã€‚
- å¤„ç†ï¼šæ˜ç¡®ä¸ºâ€œå½“å‰é˜¶æ®µç®€åŒ–å®ç°â€ï¼Œåç»­å†åšç²¾ç»†åˆ†é¡µå¼•æ“ã€‚

### 11.10 èŒƒå›´è¾¹ç•Œç¡®è®¤ï¼ˆå½“å‰é˜¶æ®µï¼‰

- ä»…åšæ–‡æœ¬å°è¯´é˜…è¯»ï¼›æ¼«ç”»/å›¾ç‰‡ç« èŠ‚ç›¸å…³èƒ½åŠ›æš‚ä¸å®ç°ã€‚
- å› æ­¤ä¸å¯¹é½ legado çš„å›¾ç‰‡ç« èŠ‚æ ·å¼ã€ç¼©æ”¾ã€ç›¸å…³æ»šåŠ¨ç­–ç•¥ã€‚
